<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pathfinder 2e Campaign Forge</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Crimson+Pro:ital,wght@0,300;0,400;0,600;1,300;1,400&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>

<header class="site-header">
  <div class="header-emblem">
    <div class="emblem-ring outer"></div>
    <div class="emblem-ring inner"></div>
    <span class="emblem-icon">âš”</span>
  </div>
  <div class="header-text">
    <h1 class="site-title">Campaign Forge</h1>
    <p class="site-subtitle">Pathfinder Second Edition Â· Complete Adventure Generator Â· PF2e Remaster Compatible</p>
  </div>
  <div class="header-emblem right">
    <div class="emblem-ring outer"></div>
    <div class="emblem-ring inner"></div>
    <span class="emblem-icon">ğŸ›¡</span>
  </div>
</header>

<main class="main-container">

  <!-- CONFIG PANEL -->
  <section class="config-panel glass-panel" id="configPanel">
    <h2 class="panel-title">
      <span class="title-ornament">âœ¦</span>
      Forge Your Campaign
      <span class="title-ornament">âœ¦</span>
    </h2>

    <div class="config-grid">

      <div class="config-group">
        <label class="config-label">Number of Players</label>
        <div class="stepper">
          <button class="step-btn" onclick="UI.step('players',-1)">âˆ’</button>
          <span class="step-val" id="playerCount">4</span>
          <button class="step-btn" onclick="UI.step('players',1)">+</button>
        </div>
        <span class="config-hint">2 â€“ 6 adventurers</span>
      </div>

      <div class="config-group">
        <label class="config-label">Starting Level</label>
        <div class="stepper">
          <button class="step-btn" onclick="UI.step('startLevel',-1)">âˆ’</button>
          <span class="step-val" id="startLevel">1</span>
          <button class="step-btn" onclick="UI.step('startLevel',1)">+</button>
        </div>
        <span class="config-hint">1 â€“ 20</span>
      </div>

      <div class="config-group">
        <label class="config-label">Ending Level</label>
        <div class="stepper">
          <button class="step-btn" onclick="UI.step('endLevel',-1)">âˆ’</button>
          <span class="step-val" id="endLevel">10</span>
          <button class="step-btn" onclick="UI.step('endLevel',1)">+</button>
        </div>
        <span class="config-hint">Must exceed start</span>
      </div>

      <div class="config-group">
        <label class="config-label">Campaign Tone</label>
        <select class="config-select" id="toneSelect">
          <option value="any">Any Tone</option>
          <option value="heroic">Heroic Adventure</option>
          <option value="dark">Dark &amp; Gritty</option>
          <option value="political">Political Intrigue</option>
          <option value="exploration">Exploration &amp; Discovery</option>
          <option value="horror">Cosmic Horror</option>
          <option value="swashbuckling">Swashbuckling</option>
        </select>
      </div>

      <div class="config-group">
        <label class="config-label">Primary Theme</label>
        <select class="config-select" id="themeSelect">
          <option value="any">Any Theme</option>
          <option value="undead">Undead &amp; Necromancy</option>
          <option value="arcane">Arcane Mysteries</option>
          <option value="divine">Divine Conflict</option>
          <option value="nature">Nature &amp; Primal</option>
          <option value="urban">Urban Intrigue</option>
          <option value="planar">Planar Travel</option>
          <option value="ancient">Ancient Ruins</option>
          <option value="political">Political Machinations</option>
        </select>
      </div>

      <div class="config-group">
        <label class="config-label">Source Inspiration</label>
        <select class="config-select" id="sourceSelect">
          <option value="any">Surprise Me</option>
          <option value="AoA">Age of Ashes</option>
          <option value="EC">Extinction Curse</option>
          <option value="AoE">Agents of Edgewatch</option>
          <option value="SoT">Strength of Thousands</option>
          <option value="OoA">Outlaws of Alkenstar</option>
          <option value="BB2">Blood Lords</option>
          <option value="GG">Gatewalkers</option>
          <option value="SR">Sky King's Tomb</option>
          <option value="WoW">War of Immortals</option>
          <option value="GoG">Curtain Call</option>
          <option value="SiW">Season of Ghosts</option>
          <option value="VP">Vaults of Pandemonium</option>
          <option value="RotR">Rise of the Runelords (PF2e)</option>
          <option value="CotCT">Crimson Throne (PF2e)</option>
          <option value="Kingmaker">Kingmaker (PF2e)</option>
          <option value="SD">Seven Dooms for Sandpoint</option>
          <option value="SW">The Slithering</option>
          <option value="BB">Beginner Box</option>
          <option value="FoF">Fists of the Ruby Phoenix</option>
          <option value="custom">Custom Mix</option>
          <optgroup label="â”€ Original Campaigns â”€">
            <option value="HD">Hellfire Dominion</option>
            <option value="WC">Courts of Endless Autumn</option>
            <option value="SC">Shipwreck Compact</option>
            <option value="PB">Plague of Brass</option>
            <option value="OD">The Oracle's Debt</option>
            <option value="TW">Thornwall Crossing</option>
            <option value="MB">The Memory Brokers</option>
            <option value="IM">Iron Meridian</option>
            <option value="HB">The Hunger Below</option>
            <option value="CE">Crown in Exile</option>
            <option value="DS">The Dreaming Siege</option>
            <option value="LC">The Last Cartographer</option>
            <option value="AR">The Abyssal Referendum</option>
            <option value="SS">The Second Sun</option>
            <option value="CB">Chains of the Beloved</option>
            <option value="UW">The Unmarked War</option>
            <option value="IA">Inheritance of Ash</option>
            <option value="PE">The Phantom Election</option>
            <option value="SL">The Sleeping Soldiers</option>
            <option value="AG">The Architect's Game</option>
          </optgroup>
        </select>
      </div>

      <div class="config-group">
        <label class="config-label">Number of Acts</label>
        <div class="stepper">
          <button class="step-btn" onclick="UI.step('acts',-1)">âˆ’</button>
          <span class="step-val" id="actCount">3</span>
          <button class="step-btn" onclick="UI.step('acts',1)">+</button>
        </div>
        <span class="config-hint">1 â€“ 6 acts</span>
      </div>

      <div class="config-group">
        <label class="config-label">Side Quests / Act</label>
        <div class="stepper">
          <button class="step-btn" onclick="UI.step('sideQuests',-1)">âˆ’</button>
          <span class="step-val" id="sideQuestCount">3</span>
          <button class="step-btn" onclick="UI.step('sideQuests',1)">+</button>
        </div>
        <span class="config-hint">1 â€“ 5 per act</span>
      </div>

    </div>

    <!-- Mix & Match -->
    <div class="mix-toggles">
      <h3 class="toggle-heading">Generation Options</h3>
      <div class="toggle-grid">
        <label class="toggle-item">
          <input type="checkbox" id="mixVillains" checked/>
          <span class="toggle-label">Unique Villain</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixLocations" checked/>
          <span class="toggle-label">Rich Locations</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixFactions" checked/>
          <span class="toggle-label">Factions &amp; Politics</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixTwists" checked/>
          <span class="toggle-label">Plot Twists</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixNPCs" checked/>
          <span class="toggle-label">Key NPCs</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixRewards" checked/>
          <span class="toggle-label">Treasure &amp; Rewards</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixHooks" checked/>
          <span class="toggle-label">Adventure Hooks</span>
        </label>
        <label class="toggle-item">
          <input type="checkbox" id="mixBosses" checked/>
          <span class="toggle-label">Boss Encounters</span>
        </label>
      </div>
    </div>

    <button class="forge-btn" id="forgeBtn" onclick="Generator.forge()">
      <span class="forge-flame">ğŸ”¥</span>
      <span class="forge-text">FORGE CAMPAIGN</span>
      <span class="forge-flame">ğŸ”¥</span>
    </button>
  </section>

  <!-- LOADING -->
  <div class="loading-overlay" id="loadingOverlay" style="display:none;">
    <div class="loading-content">
      <div class="loading-sigil">âš”</div>
      <p class="loading-text">Weaving the threads of fateâ€¦</p>
      <div class="loading-bar"><div class="loading-fill" id="loadingFill"></div></div>
      <p class="loading-step" id="loadingStep">Generating plotâ€¦</p>
    </div>
  </div>

  <!-- OUTPUT PANEL -->
  <section class="output-panel" id="outputPanel" style="display:none;">

    <div class="output-toolbar">
      <button class="tool-btn primary" onclick="Generator.reforge()">âš’ Reforge</button>
      <button class="tool-btn" onclick="UI.openMixModal()">ğŸ”€ Mix &amp; Match</button>
      <button class="tool-btn" onclick="UI.exportJSON()">ğŸ’¾ Save JSON</button>
      <button class="tool-btn" onclick="UI.loadJSON()">ğŸ“‚ Load JSON</button>
      <button class="tool-btn" onclick="UI.printCampaign()">ğŸ–¨ Print</button>
      <button class="tool-btn" onclick="UI.copyMarkdown()">ğŸ“‹ Copy</button>
      <button class="tool-btn danger" onclick="UI.reset()">âœ• New Campaign</button>
    </div>

    <!-- Tab bar -->
    <div class="tab-bar">
      <button class="tab-btn active" id="tab-campaign"   onclick="UI.switchTab('campaign')">ğŸ“œ Campaign</button>
      <button class="tab-btn" id="tab-region"            onclick="UI.switchTab('region')">ğŸ—º Regional Map</button>
      <button class="tab-btn" id="tab-dungeon"           onclick="UI.switchTab('dungeon')">âš” Dungeon Map</button>
      <button class="tab-btn" id="tab-factions"          onclick="UI.switchTab('factions')">âš– Faction Web</button>
      <button class="tab-btn" id="tab-timeline"          onclick="UI.switchTab('timeline')">ğŸ“… Timeline</button>
      <button class="tab-btn" id="tab-encounters"        onclick="UI.switchTab('encounters')">ğŸ‰ Encounters</button>
      <button class="tab-btn" id="tab-sessionzero"       onclick="UI.switchTab('sessionzero')">ğŸ² Session Zero</button>
    </div>

    <!-- Tab: Campaign doc -->
    <div class="tab-pane active" id="pane-campaign">
      <div class="campaign-output" id="campaignOutput"></div>
    </div>

    <!-- Tab: Regional Map -->
    <div class="tab-pane" id="pane-region">
      <div class="map-panel">
        <div class="map-controls">
          <div class="map-control-group">
            <label class="config-label">Map Style</label>
            <select class="config-select" id="mapPalette" onchange="UI.redrawRegional()">
              <option value="parchment">Parchment (Day)</option>
              <option value="night">Night / Tactical</option>
            </select>
          </div>
          <div class="map-control-group">
            <label class="config-label">Variation</label>
            <div class="stepper small">
              <button class="step-btn" onclick="UI.stepMapVariant(-1)">âˆ’</button>
              <span class="step-val" id="mapVariant">1</span>
              <button class="step-btn" onclick="UI.stepMapVariant(1)">+</button>
            </div>
          </div>
          <button class="tool-btn" onclick="UI.downloadCanvas('regionalCanvas','regional-map')">â¬‡ Download PNG</button>
        </div>
        <div class="canvas-wrap">
          <canvas id="regionalCanvas" width="900" height="580"></canvas>
        </div>
        <div class="map-legend-text" id="regionalLegend"></div>
      </div>
    </div>

    <!-- Tab: Dungeon Map -->
    <div class="tab-pane" id="pane-dungeon">
      <div class="map-panel">
        <div class="map-controls">
          <div class="map-control-group">
            <label class="config-label">Location</label>
            <select class="config-select" id="dungeonLocation" onchange="UI.redrawDungeon()">
              <!-- Populated after generation -->
            </select>
          </div>
          <div class="map-control-group">
            <label class="config-label">Variation</label>
            <div class="stepper small">
              <button class="step-btn" onclick="UI.stepDungeonVariant(-1)">âˆ’</button>
              <span class="step-val" id="dungeonVariant">1</span>
              <button class="step-btn" onclick="UI.stepDungeonVariant(1)">+</button>
            </div>
          </div>
          <button class="tool-btn" onclick="UI.downloadCanvas('dungeonCanvas','dungeon-map')">â¬‡ Download PNG</button>
        </div>
        <div class="canvas-wrap">
          <canvas id="dungeonCanvas" width="900" height="580"></canvas>
        </div>
        <div class="map-legend-text" id="dungeonLegend">
          <strong>Reading the map:</strong> Filled rectangles = doors Â· S = secret door Â· Stair patterns = level transitions Â· Named circles = key features
        </div>
      </div>
    </div>

    <!-- Tab: Faction Web (Phase 2) -->
    <div class="tab-pane" id="pane-factions">
      <div class="map-panel">
        <div class="map-controls">
          <button class="tool-btn" onclick="UI.redrawFactions()">â†º Redraw</button>
          <button class="tool-btn" onclick="UI.downloadCanvas('factionCanvas','faction-map')">â¬‡ Download PNG</button>
          <span class="map-hint">Hover over nodes and edges for details</span>
        </div>
        <div class="canvas-wrap" style="position:relative;">
          <canvas id="factionCanvas" width="900" height="580"></canvas>
          <!-- Tooltip overlay -->
          <div id="factionTooltip" class="faction-tooltip" style="display:none;"></div>
        </div>
        <div class="map-legend-text" id="factionLegend">
          <strong>Nodes:</strong> âœ“ = Ally Â· âœ• = Villain Â· ? = Wildcard &nbsp;|&nbsp;
          <strong>Edges:</strong> Solid green = Allied Â· Dashed = Neutral Â· Solid red = Hostile Â· Purple dash = Secret Deal
        </div>
      </div>
    </div>

    <!-- Tab: Timeline (Phase 3) -->
    <div class="tab-pane" id="pane-timeline">
      <div class="map-panel">
        <div class="map-controls">
          <button class="tool-btn" onclick="UI.redrawTimeline()">â†º Refresh</button>
          <button class="tool-btn" onclick="UI.downloadCanvas('timelineCanvas','campaign-timeline')">â¬‡ Download PNG</button>
          <span class="map-hint">Click any node to see details below</span>
        </div>
        <div class="canvas-wrap" style="overflow-y:auto; max-height:560px;">
          <canvas id="timelineCanvas" width="900" height="520"></canvas>
        </div>
        <div id="timelineDetail" class="tl-detail-panel" style="display:none;"></div>
        <div class="map-legend-text">
          <strong>âš” Main Act</strong> Â· <strong>ğŸ’€ Boss Encounter</strong> Â· <strong>! Plot Twist</strong> Â· <strong>â—† Side Quest</strong>
          &nbsp;â€” Click nodes to expand details
        </div>
      </div>
    </div>

    <!-- Tab: Encounter Builder (Phase 3) -->
    <div class="tab-pane" id="pane-encounters">
      <div id="encounterBuilderRoot" class="campaign-output"></div>
    </div>

    <!-- Tab: Session Zero (Phase 3) -->
    <div class="tab-pane" id="pane-sessionzero">
      <div id="sessionZeroRoot" class="campaign-output"></div>
    </div>

  </section>

  <!-- MIX & MATCH MODAL -->
  <div class="modal-backdrop" id="mixModal" style="display:none;" onclick="UI.closeMixModal(event)">
    <div class="modal-panel">
      <button class="modal-close" onclick="UI.closeMixModal()">âœ•</button>
      <h2 class="modal-title">âš— Mix &amp; Match</h2>
      <p class="modal-desc">Swap any component to reshape your campaign. Changes apply immediately.</p>
      <div id="mixModalContent" class="mix-content"></div>
      <div class="modal-actions">
        <button class="forge-btn small" onclick="UI.applyMix()">âœ“ Apply Changes</button>
        <button class="tool-btn" onclick="UI.closeMixModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hidden file input for JSON load -->
  <input type="file" id="jsonFileInput" accept=".json" style="display:none" onchange="UI.handleJSONLoad(event)"/>

</main>

<footer class="site-footer">
  <p>Campaign Forge Â· Pathfinder 2e Remaster Compatible Â· Inspired by Paizo Publishing Â· Not affiliated with or endorsed by Paizo Â· For personal use at the gaming table</p>
</footer>

<script src="data/campaigns.js"></script>
<script src="data/campaigns_extra.js"></script>
<script src="data/campaigns_extra2.js"></script>
<script src="data/campaigns_extra3.js"></script>
<script src="data/components.js"></script>
<script src="data/components_extra.js"></script>
<script src="data/components_extra2.js"></script>
<script src="data/components_extra3.js"></script>
<script src="data/social.js"></script>
<script src="data/statblocks.js"></script>
<script src="js/encounterBuilder.js"></script>
<script src="js/generator.js"></script>
<script src="js/renderer.js"></script>
<script src="js/mapGenerator.js"></script>
<script src="js/factionMap.js"></script>
<script src="js/timeline.js"></script>
<script src="js/sessionZero.js"></script>
<script src="js/ui.js"></script>
</body>
</html>
