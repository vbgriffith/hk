<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monaco Editor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.css">
  <style>
    :root {
      --bg:        #1e1e1e;
      --surface:   #252526;
      --surface2:  #2d2d2d;
      --border:    #3c3c3c;
      --text:      #cccccc;
      --text-dim:  #858585;
      --accent:    #007acc;
      --accent2:   #0098ff;
      --green:     #4ec9b0;
      --red:       #f44747;
      --yellow:    #cca700;
      --tab-h:     35px;
      --sidebar-w: 220px;
      --status-h:  22px;
      --titlebar-h:30px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* â”€â”€ Title Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #titlebar {
      height: var(--titlebar-h);
      background: #3c3c3c;
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 8px;
      flex-shrink: 0;
      user-select: none;
    }
    .dot { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; }
    .dot.r { background: #ff5f57; }
    .dot.y { background: #febc2e; }
    .dot.g { background: #28c840; }
    #titlebar .title {
      flex: 1; text-align: center;
      font-size: 12px; color: #ccc;
      margin-left: -60px;
      pointer-events: none;
    }

    /* â”€â”€ Menu Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #menubar {
      height: 28px;
      background: var(--surface);
      display: flex;
      align-items: center;
      padding: 0 4px;
      gap: 2px;
      flex-shrink: 0;
      border-bottom: 1px solid var(--border);
    }
    .menu-item {
      padding: 0 10px;
      height: 28px;
      display: flex;
      align-items: center;
      font-size: 13px;
      color: var(--text);
      cursor: pointer;
      border-radius: 3px;
      position: relative;
    }
    .menu-item:hover { background: var(--border); }
    .menu-item.open { background: var(--border); }

    .dropdown {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      background: #2d2d2d;
      border: 1px solid #555;
      border-radius: 4px;
      min-width: 200px;
      z-index: 200;
      box-shadow: 0 4px 16px rgba(0,0,0,.4);
      padding: 4px 0;
    }
    .dropdown.visible { display: block; }
    .dd-item {
      padding: 5px 16px;
      font-size: 13px;
      color: var(--text);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 24px;
    }
    .dd-item:hover { background: var(--accent); color: #fff; }
    .dd-item .shortcut { color: var(--text-dim); font-size: 11px; }
    .dd-item:hover .shortcut { color: rgba(255,255,255,.7); }
    .dd-sep { height: 1px; background: var(--border); margin: 4px 0; }

    /* â”€â”€ Tab Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #tabbar {
      height: var(--tab-h);
      background: #2d2d2d;
      display: flex;
      align-items: flex-end;
      flex-shrink: 0;
      border-bottom: 1px solid var(--bg);
      overflow-x: auto;
      overflow-y: hidden;
      scrollbar-width: thin;
    }
    #tabbar::-webkit-scrollbar { height: 3px; }
    #tabbar::-webkit-scrollbar-thumb { background: var(--border); }

    .tab {
      height: var(--tab-h);
      padding: 0 12px;
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 13px;
      color: #969696;
      background: #2d2d2d;
      border-right: 1px solid var(--bg);
      cursor: pointer;
      white-space: nowrap;
      flex-shrink: 0;
      border-top: 1px solid transparent;
      transition: background .1s;
    }
    .tab:hover { background: var(--surface); color: #ccc; }
    .tab.active { background: var(--bg); color: #fff; border-top-color: var(--accent); }
    .tab .tab-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
    .tab .tab-close {
      opacity: 0; font-size: 15px; line-height: 1;
      padding: 1px 3px; border-radius: 3px;
    }
    .tab:hover .tab-close { opacity: 1; }
    .tab .tab-close:hover { background: #555; }
    #add-tab {
      height: var(--tab-h); padding: 0 12px;
      display: flex; align-items: center;
      color: var(--text-dim); cursor: pointer;
      font-size: 18px; flex-shrink: 0;
    }
    #add-tab:hover { color: #fff; background: var(--surface); }

    /* â”€â”€ Body â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #body {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* â”€â”€ Activity Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #actbar {
      width: 48px;
      background: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 4px;
      gap: 2px;
      flex-shrink: 0;
    }
    .act-icon {
      width: 40px; height: 40px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; border-radius: 4px; color: #858585;
      font-size: 18px; position: relative; flex-shrink: 0;
      transition: color .15s;
    }
    .act-icon:hover { color: #fff; }
    .act-icon.on { color: #fff; }
    .act-icon.on::before {
      content: '';
      position: absolute; left: 0; top: 8px; bottom: 8px;
      width: 2px; background: var(--accent);
      border-radius: 0 2px 2px 0;
    }
    .act-icon svg { width: 22px; height: 22px; fill: currentColor; }

    /* â”€â”€ Sidebar Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #sidebar {
      width: var(--sidebar-w);
      background: var(--surface);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      border-right: 1px solid var(--bg);
      overflow: hidden;
      transition: width .15s;
    }
    #sidebar.closed { width: 0; }

    #sidebar-header {
      padding: 11px 12px 7px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em;
      color: #bbb;
      text-transform: uppercase;
      flex-shrink: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #sidebar-header .sb-actions { display: flex; gap: 6px; }
    .sb-btn {
      background: none; border: none; color: var(--text-dim);
      cursor: pointer; font-size: 15px; padding: 2px 4px;
      border-radius: 3px; line-height: 1;
    }
    .sb-btn:hover { color: #fff; background: var(--border); }

    #file-list {
      flex: 1;
      overflow-y: auto;
      font-size: 13px;
    }
    #file-list::-webkit-scrollbar { width: 6px; }
    #file-list::-webkit-scrollbar-thumb { background: var(--border); }

    .file-row {
      padding: 3px 8px 3px 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 7px;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      user-select: none;
    }
    .file-row:hover { background: #2a2d2e; }
    .file-row.active { background: #094771; color: #fff; }
    .file-row .fi { font-size: 14px; flex-shrink: 0; }
    .file-row .fn { overflow: hidden; text-overflow: ellipsis; }

    /* â”€â”€ Editor Pane â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #editor-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    #editor { flex: 1; }

    /* â”€â”€ Status Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #statusbar {
      height: var(--status-h);
      background: var(--accent);
      display: flex;
      align-items: center;
      padding: 0 10px;
      font-size: 12px;
      color: #fff;
      gap: 14px;
      flex-shrink: 0;
      user-select: none;
    }
    .sb-item { cursor: pointer; opacity: .9; white-space: nowrap; }
    .sb-item:hover { opacity: 1; }
    #sb-right { margin-left: auto; display: flex; gap: 14px; }

    /* â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal-bg {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.5);
      display: flex; align-items: center; justify-content: center;
      z-index: 999;
    }
    .modal-bg.hidden { display: none; }
    .modal {
      background: var(--surface2);
      border: 1px solid #555;
      border-radius: 6px;
      padding: 22px;
      width: 340px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      box-shadow: 0 8px 32px rgba(0,0,0,.5);
    }
    .modal h3 { font-size: 14px; color: #eee; font-weight: 600; }
    .modal input, .modal select {
      background: var(--border);
      border: 1px solid #555;
      color: #fff;
      padding: 7px 10px;
      font-size: 13px;
      border-radius: 3px;
      outline: none;
      width: 100%;
    }
    .modal input:focus, .modal select:focus { border-color: var(--accent); }
    .modal-btns { display: flex; gap: 8px; justify-content: flex-end; }
    .btn-ok     { background: var(--accent); color: #fff; border: none; padding: 6px 16px; border-radius: 3px; cursor: pointer; font-size: 13px; }
    .btn-ok:hover { background: var(--accent2); }
    .btn-cancel { background: var(--border); color: #ccc; border: none; padding: 6px 16px; border-radius: 3px; cursor: pointer; font-size: 13px; }
    .btn-cancel:hover { background: #505050; }

    /* â”€â”€ Command Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #palette-bg {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.5);
      display: flex; align-items: flex-start; justify-content: center;
      padding-top: 80px;
      z-index: 1000;
    }
    #palette-bg.hidden { display: none; }
    #palette {
      background: var(--surface2);
      border: 1px solid #555;
      border-radius: 6px;
      width: 520px;
      max-width: 90vw;
      box-shadow: 0 8px 32px rgba(0,0,0,.6);
      overflow: hidden;
    }
    #palette input {
      width: 100%;
      background: var(--surface2);
      border: none;
      border-bottom: 1px solid var(--border);
      color: #fff;
      padding: 12px 16px;
      font-size: 14px;
      outline: none;
    }
    .pal-item {
      padding: 8px 16px;
      font-size: 13px;
      color: var(--text);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
    }
    .pal-item:hover, .pal-item.focused { background: var(--accent); color: #fff; }
    .pal-item .pal-key { color: rgba(255,255,255,.6); font-size: 11px; }

    /* scrollbars */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>
<body>

<!-- New File Modal -->
<div class="modal-bg hidden" id="new-modal">
  <div class="modal">
    <h3>New File</h3>
    <input id="new-name" type="text" placeholder="e.g. script.js, style.css, index.html" autocomplete="off">
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('new-modal')">Cancel</button>
      <button class="btn-ok" onclick="confirmNew()">Create</button>
    </div>
  </div>
</div>

<!-- Rename Modal -->
<div class="modal-bg hidden" id="rename-modal">
  <div class="modal">
    <h3>Rename File</h3>
    <input id="rename-input" type="text" autocomplete="off">
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('rename-modal')">Cancel</button>
      <button class="btn-ok" onclick="confirmRename()">Rename</button>
    </div>
  </div>
</div>

<!-- Change Language Modal -->
<div class="modal-bg hidden" id="lang-modal">
  <div class="modal">
    <h3>Select Language</h3>
    <select id="lang-select"></select>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="closeModal('lang-modal')">Cancel</button>
      <button class="btn-ok" onclick="confirmLang()">Apply</button>
    </div>
  </div>
</div>

<!-- Command Palette -->
<div id="palette-bg" class="hidden">
  <div id="palette">
    <input id="palette-input" type="text" placeholder="Type a commandâ€¦" autocomplete="off">
    <div id="palette-list"></div>
  </div>
</div>

<!-- Title Bar -->
<div id="titlebar">
  <div class="dot r" title="Close"></div>
  <div class="dot y" title="Minimize"></div>
  <div class="dot g" title="Maximize"></div>
  <div class="title" id="title-text">Monaco Editor</div>
</div>

<!-- Menu Bar -->
<div id="menubar">
  <div class="menu-item" data-menu="file">File
    <div class="dropdown" id="menu-file">
      <div class="dd-item" onclick="openModal('new-modal')">New File <span class="shortcut">Ctrl+N</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="saveFile()">Save <span class="shortcut">Ctrl+S</span></div>
      <div class="dd-item" onclick="saveAllFiles()">Save All <span class="shortcut">Ctrl+Shift+S</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="downloadFile()">Download Current File</div>
      <div class="dd-item" onclick="downloadAll()">Download All as ZIP</div>
    </div>
  </div>
  <div class="menu-item" data-menu="edit">Edit
    <div class="dropdown" id="menu-edit">
      <div class="dd-item" onclick="editorCmd('undo')">Undo <span class="shortcut">Ctrl+Z</span></div>
      <div class="dd-item" onclick="editorCmd('redo')">Redo <span class="shortcut">Ctrl+Y</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="editorCmd('editor.action.formatDocument')">Format Document <span class="shortcut">Alt+Shift+F</span></div>
      <div class="dd-item" onclick="editorCmd('editor.action.commentLine')">Toggle Comment <span class="shortcut">Ctrl+/</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="editorCmd('actions.find')">Find <span class="shortcut">Ctrl+F</span></div>
      <div class="dd-item" onclick="editorCmd('editor.action.startFindReplaceAction')">Replace <span class="shortcut">Ctrl+H</span></div>
    </div>
  </div>
  <div class="menu-item" data-menu="view">View
    <div class="dropdown" id="menu-view">
      <div class="dd-item" onclick="toggleSidebar()">Toggle Explorer <span class="shortcut">Ctrl+B</span></div>
      <div class="dd-item" onclick="toggleMinimap()">Toggle Minimap</div>
      <div class="dd-item" onclick="toggleWordWrap()">Toggle Word Wrap <span class="shortcut">Alt+Z</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="zoomIn()">Zoom In <span class="shortcut">Ctrl+=</span></div>
      <div class="dd-item" onclick="zoomOut()">Zoom Out <span class="shortcut">Ctrl+-</span></div>
      <div class="dd-sep"></div>
      <div class="dd-item" onclick="cycleTheme()">Toggle Theme</div>
    </div>
  </div>
  <div class="menu-item" data-menu="file2">Language
    <div class="dropdown" id="menu-file2">
      <div class="dd-item" onclick="openLangModal()">Change Language Modeâ€¦</div>
    </div>
  </div>
</div>

<!-- Tab Bar -->
<div id="tabbar">
  <div id="add-tab" onclick="openModal('new-modal')" title="New file (Ctrl+N)">+</div>
</div>

<!-- Body -->
<div id="body">
  <div id="actbar">
    <div class="act-icon on" id="act-explorer" onclick="toggleSidebar()" title="Explorer">
      <svg viewBox="0 0 24 24"><path d="M20 6h-2.18c.07-.23.18-.46.18-.71A2.3 2.3 0 0 0 15.71 3a2.3 2.3 0 0 0-1.62.67L12 5.76 9.91 3.67A2.3 2.3 0 0 0 8.29 3 2.3 2.3 0 0 0 6 5.29c0 .25.11.48.18.71H4a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-8.29-1.38c.19-.19.45-.29.7-.29a.79.79 0 0 1 .79.79.79.79 0 0 1-.23.56L12 7.35l-.97-.97.68-.76zM7.5 5.29a.79.79 0 0 1 .79-.79c.25 0 .51.1.7.29l.68.76-.97.97-.97-.97a.79.79 0 0 1-.23-.26zM20 19H4V8h16v11z"/></svg>
    </div>
    <div class="act-icon" onclick="saveFile()" title="Save (Ctrl+S)">
      <svg viewBox="0 0 24 24"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm3-10H5V5h10v4z"/></svg>
    </div>
    <div class="act-icon" onclick="editorCmd('editor.action.formatDocument')" title="Format (Alt+Shift+F)">
      <svg viewBox="0 0 24 24"><path d="M3 5h12v2H3V5zm0 4h8v2H3V9zm0 4h12v2H3v-2zm0 4h8v2H3v-2zm16-8l-4 4 4 4 1.5-1.5L18 13l2.5-2.5L19 9z"/></svg>
    </div>
    <div class="act-icon" onclick="openPalette()" title="Command Palette (Ctrl+Shift+P)">
      <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
    </div>
    <div class="act-icon" onclick="cycleTheme()" title="Toggle Theme">
      <svg viewBox="0 0 24 24"><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/></svg>
    </div>
  </div>

  <div id="sidebar">
    <div id="sidebar-header">
      Explorer
      <div class="sb-actions">
        <button class="sb-btn" onclick="openModal('new-modal')" title="New file">+</button>
        <button class="sb-btn" onclick="deleteActive()" title="Delete file">âœ•</button>
        <button class="sb-btn" onclick="openRenameModal()" title="Rename file">âœ</button>
      </div>
    </div>
    <div id="file-list"></div>
  </div>

  <div id="editor-wrap">
    <div id="editor"></div>
  </div>
</div>

<div id="statusbar">
  <span class="sb-item" id="sb-branch">â‡ main</span>
  <span class="sb-item" id="sb-errors">âœ“ No problems</span>
  <div id="sb-right">
    <span class="sb-item" id="sb-cursor">Ln 1, Col 1</span>
    <span class="sb-item" id="sb-lang" onclick="openLangModal()">JavaScript</span>
    <span class="sb-item">UTF-8</span>
    <span class="sb-item">LF</span>
  </div>
</div>

<!-- jsDelivr: Monaco loader -->
<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>

<!-- jsDelivr: JSZip for download-all -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

<script>
'use strict';

// â”€â”€â”€ Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const VS_PATH = 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs';

const EXT_LANG = {
  js:'javascript', jsx:'javascript', ts:'typescript', tsx:'typescript',
  html:'html', htm:'html', css:'css', scss:'scss', less:'less',
  json:'json', md:'markdown', markdown:'markdown',
  py:'python', rs:'rust', go:'go',
  c:'c', cpp:'cpp', h:'cpp', java:'java',
  sh:'shell', bash:'shell', rb:'ruby', php:'php',
  sql:'sql', xml:'xml', yaml:'yaml', yml:'yaml',
  toml:'ini', txt:'plaintext', env:'ini', gitignore:'plaintext',
};

const LANG_COLOR = {
  javascript:'#f0db4f', typescript:'#3178c6', html:'#e34c26', css:'#264de4',
  scss:'#c6538c', json:'#aaa', markdown:'#9e9e9e', python:'#3572a5',
  rust:'#dea584', go:'#00add8', cpp:'#f34b7d', java:'#b07219',
  shell:'#89e051', ruby:'#701516', php:'#4f5d95', sql:'#e38c00',
  yaml:'#cb171e', xml:'#f60', plaintext:'#666', default:'#666',
};

const LANG_ICON = {
  javascript:'ğŸŸ¨', typescript:'ğŸ”·', html:'ğŸŸ§', css:'ğŸŸ¦', scss:'ğŸŸ£',
  json:'ğŸ“‹', markdown:'ğŸ“', python:'ğŸ', rust:'ğŸ¦€', go:'ğŸ¹',
  cpp:'âš™ï¸', java:'â˜•', shell:'ğŸ’²', ruby:'ğŸ’', php:'ğŸ˜',
  sql:'ğŸ—„ï¸', xml:'ğŸ“°', yaml:'ğŸ“„', plaintext:'ğŸ“„', default:'ğŸ“„',
};

const THEMES = ['vs-dark', 'vs', 'hc-black'];

const DEFAULT_FILES = {
  'index.js': `// Monaco Editor running locally\n// All scripts loaded from cdn.jsdelivr.net\n\nfunction greet(name) {\n  return \`Hello, \${name}! ğŸ‘‹\`;\n}\n\nconsole.log(greet('World'));\n`,
  'style.css': `/* Styles */\n\nbody {\n  margin: 0;\n  font-family: system-ui, sans-serif;\n  background: #fff;\n  color: #222;\n}\n`,
  'index.html': `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>My App</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <h1>Hello World</h1>\n  <script src="index.js"><\/script>\n</body>\n</html>\n`,
  'README.md': `# My Project\n\nEdit your files here.\n\n## Keyboard Shortcuts\n\n| Key | Action |\n|-----|--------|\n| \`Ctrl+S\` | Save |\n| \`Ctrl+N\` | New file |\n| \`Ctrl+B\` | Toggle sidebar |\n| \`Alt+Shift+F\` | Format |\n| \`Ctrl+Shift+P\` | Command palette |\n`,
};

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let editor = null;
let files  = {};   // { name: { model, viewState, lang } }
let active = null;
let themeIdx = 0;
let minimapOn = true;
let wordWrap = false;
let fontSize = 14;
let sidebarOpen = true;

// â”€â”€â”€ Storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function persist() {
  const data = {};
  for (const [n, f] of Object.entries(files)) data[n] = f.model.getValue();
  try { localStorage.setItem('monaco-files', JSON.stringify(data)); } catch {}
}

function loadStored() {
  try {
    const raw = localStorage.getItem('monaco-files');
    return raw ? JSON.parse(raw) : null;
  } catch { return null; }
}

// â”€â”€â”€ Language helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function langFor(name) {
  const ext = (name.split('.').pop() || '').toLowerCase();
  return EXT_LANG[ext] || 'plaintext';
}
function colorFor(lang) { return LANG_COLOR[lang] || LANG_COLOR.default; }
function iconFor(lang)  { return LANG_ICON[lang]  || LANG_ICON.default;  }

// â”€â”€â”€ Tab / File List rendering â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  // Tabs
  document.querySelectorAll('.tab').forEach(t => t.remove());
  const addBtn = document.getElementById('add-tab');
  for (const name of Object.keys(files)) {
    const lang = files[name].lang;
    const tab = document.createElement('div');
    tab.className = 'tab' + (name === active ? ' active' : '');
    tab.dataset.name = name;
    tab.innerHTML =
      `<span class="tab-dot" style="background:${colorFor(lang)}"></span>` +
      `<span>${name}</span>` +
      `<span class="tab-close" data-close="${name}">Ã—</span>`;
    tab.addEventListener('click', e => {
      if (e.target.dataset.close) { closeFile(e.target.dataset.close); return; }
      switchTo(name);
    });
    document.getElementById('tabbar').insertBefore(tab, addBtn);
  }

  // File list
  const list = document.getElementById('file-list');
  list.innerHTML = '';
  for (const name of Object.keys(files)) {
    const lang = files[name].lang;
    const row = document.createElement('div');
    row.className = 'file-row' + (name === active ? ' active' : '');
    row.innerHTML = `<span class="fi">${iconFor(lang)}</span><span class="fn">${name}</span>`;
    row.addEventListener('click', () => switchTo(name));
    list.appendChild(row);
  }

  document.getElementById('title-text').textContent =
    active ? `${active} â€” Monaco Editor` : 'Monaco Editor';
}

// â”€â”€â”€ Switch / Create / Close â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTo(name) {
  if (!files[name]) return;
  if (active && files[active]) files[active].viewState = editor.saveViewState();

  active = name;
  editor.setModel(files[name].model);
  if (files[name].viewState) editor.restoreViewState(files[name].viewState);
  editor.focus();

  document.getElementById('sb-lang').textContent =
    files[name].lang.charAt(0).toUpperCase() + files[name].lang.slice(1);

  render();
}

function addFile(name, content = '', focus = true) {
  if (files[name]) { if (focus) switchTo(name); return; }
  const lang  = langFor(name);
  const model = monaco.editor.createModel(content, lang);
  model.onDidChangeContent(persist);
  files[name] = { model, viewState: null, lang };
  if (focus) switchTo(name);
  else render();
  persist();
}

function closeFile(name) {
  if (!files[name]) return;
  files[name].model.dispose();
  delete files[name];
  persist();

  const keys = Object.keys(files);
  if (!keys.length) addFile('untitled.js', '');
  else if (active === name) switchTo(keys[keys.length - 1]);
  else render();
}

function deleteActive() {
  if (!active) return;
  if (Object.keys(files).length === 1) { alert("Can't delete the last file."); return; }
  if (confirm(`Delete "${active}"?`)) closeFile(active);
}

// â”€â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id) {
  closeAllMenus();
  document.getElementById(id).classList.remove('hidden');
  const inp = document.querySelector(`#${id} input`);
  if (inp) { inp.value = ''; setTimeout(() => inp.focus(), 50); }
}
function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

function confirmNew() {
  const name = document.getElementById('new-name').value.trim();
  closeModal('new-modal');
  if (name) addFile(name, '');
}

let renamingFrom = null;
function openRenameModal() {
  if (!active) return;
  renamingFrom = active;
  openModal('rename-modal');
  document.getElementById('rename-input').value = active;
  document.getElementById('rename-input').select();
}
function confirmRename() {
  const newName = document.getElementById('rename-input').value.trim();
  closeModal('rename-modal');
  if (!newName || !renamingFrom || newName === renamingFrom) return;
  const content = files[renamingFrom].model.getValue();
  closeFile(renamingFrom);
  addFile(newName, content);
}

// Language modal
const ALL_LANGS = [
  'plaintext','abap','apex','azcli','bat','cameligo','clojure','coffeescript',
  'c','cpp','csharp','csp','css','dart','dockerfile','elixir','flow9','fsharp',
  'go','graphql','handlebars','html','ini','java','javascript','json','julia',
  'kotlin','less','lexon','lua','m3','markdown','mips','msdax','mysql',
  'objective-c','pascal','pascaligo','perl','pgsql','php','postiats','powerquery',
  'powershell','pug','python','r','razor','redis','redshift','restructuredtext',
  'ruby','rust','sb','scala','scheme','scss','shell','sol','sql','st','swift',
  'systemverilog','tcl','twig','typescript','vb','xml','yaml',
];

function openLangModal() {
  closeAllMenus();
  const sel = document.getElementById('lang-select');
  sel.innerHTML = ALL_LANGS.map(l =>
    `<option value="${l}"${l === (active && files[active]?.lang) ? ' selected' : ''}>${l}</option>`
  ).join('');
  openModal('lang-modal');
  document.getElementById('lang-select').focus();
}

function confirmLang() {
  const lang = document.getElementById('lang-select').value;
  closeModal('lang-modal');
  if (!active || !files[active]) return;
  files[active].lang = lang;
  monaco.editor.setModelLanguage(files[active].model, lang);
  document.getElementById('sb-lang').textContent = lang.charAt(0).toUpperCase() + lang.slice(1);
  render();
}

// â”€â”€â”€ Save / Download â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveFile() {
  persist();
  // visual flash on status bar
  const el = document.getElementById('sb-errors');
  const prev = el.textContent;
  el.textContent = 'âœ“ Saved';
  setTimeout(() => el.textContent = prev, 1200);
}

function saveAllFiles() { persist(); saveFile(); }

function downloadFile() {
  if (!active) return;
  const blob = new Blob([editor.getValue()], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = active;
  a.click();
  URL.revokeObjectURL(a.href);
}

async function downloadAll() {
  const zip = new JSZip();
  for (const [name, f] of Object.entries(files)) {
    zip.file(name, f.model.getValue());
  }
  const blob = await zip.generateAsync({ type: 'blob' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'monaco-files.zip';
  a.click();
  URL.revokeObjectURL(a.href);
}

// â”€â”€â”€ View Toggles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleSidebar() {
  sidebarOpen = !sidebarOpen;
  document.getElementById('sidebar').classList.toggle('closed', !sidebarOpen);
  document.getElementById('act-explorer').classList.toggle('on', sidebarOpen);
}

function toggleMinimap() {
  minimapOn = !minimapOn;
  editor.updateOptions({ minimap: { enabled: minimapOn } });
}

function toggleWordWrap() {
  wordWrap = !wordWrap;
  editor.updateOptions({ wordWrap: wordWrap ? 'on' : 'off' });
}

function cycleTheme() {
  themeIdx = (themeIdx + 1) % THEMES.length;
  monaco.editor.setTheme(THEMES[themeIdx]);
}

function zoomIn()  { fontSize = Math.min(fontSize + 1, 28); editor.updateOptions({ fontSize }); }
function zoomOut() { fontSize = Math.max(fontSize - 1, 10); editor.updateOptions({ fontSize }); }

// â”€â”€â”€ Editor commands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function editorCmd(cmd) {
  closeAllMenus();
  if (cmd === 'undo') { editor.trigger('', 'undo', null); return; }
  if (cmd === 'redo') { editor.trigger('', 'redo', null); return; }
  editor.getAction(cmd)?.run();
}

// â”€â”€â”€ Menu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function closeAllMenus() {
  document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('visible'));
  document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('open'));
}

document.getElementById('menubar').addEventListener('click', e => {
  const item = e.target.closest('.menu-item');
  if (!item) return;
  const key = item.dataset.menu;
  const drop = document.getElementById('menu-' + key);
  if (!drop) return;
  const wasOpen = drop.classList.contains('visible');
  closeAllMenus();
  if (!wasOpen) { drop.classList.add('visible'); item.classList.add('open'); }
});

document.addEventListener('click', e => {
  if (!e.target.closest('#menubar')) closeAllMenus();
  if (!e.target.closest('#palette-bg') && !e.target.closest('#palette-bg input')) {
    // handled by palette keydown
  }
});

// â”€â”€â”€ Command Palette â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const COMMANDS = [
  { label: 'New File',             key: 'Ctrl+N',         run: () => openModal('new-modal') },
  { label: 'Save',                 key: 'Ctrl+S',         run: saveFile },
  { label: 'Download Current',     key: '',               run: downloadFile },
  { label: 'Download All as ZIP',  key: '',               run: downloadAll },
  { label: 'Format Document',      key: 'Alt+Shift+F',    run: () => editorCmd('editor.action.formatDocument') },
  { label: 'Toggle Comment',       key: 'Ctrl+/',         run: () => editorCmd('editor.action.commentLine') },
  { label: 'Find',                 key: 'Ctrl+F',         run: () => editorCmd('actions.find') },
  { label: 'Find & Replace',       key: 'Ctrl+H',         run: () => editorCmd('editor.action.startFindReplaceAction') },
  { label: 'Toggle Sidebar',       key: 'Ctrl+B',         run: toggleSidebar },
  { label: 'Toggle Minimap',       key: '',               run: toggleMinimap },
  { label: 'Toggle Word Wrap',     key: 'Alt+Z',          run: toggleWordWrap },
  { label: 'Toggle Theme',         key: '',               run: cycleTheme },
  { label: 'Change Language Mode', key: '',               run: openLangModal },
  { label: 'Rename File',          key: '',               run: openRenameModal },
  { label: 'Delete File',          key: '',               run: deleteActive },
  { label: 'Zoom In',              key: 'Ctrl+=',         run: zoomIn },
  { label: 'Zoom Out',             key: 'Ctrl+-',         run: zoomOut },
];

let palFocus = 0;
function openPalette() {
  closeAllMenus();
  document.getElementById('palette-bg').classList.remove('hidden');
  document.getElementById('palette-input').value = '';
  renderPalette('');
  document.getElementById('palette-input').focus();
  palFocus = 0;
}
function closePalette() { document.getElementById('palette-bg').classList.add('hidden'); }

function renderPalette(query) {
  const q = query.toLowerCase();
  const list = document.getElementById('palette-list');
  const matches = COMMANDS.filter(c => c.label.toLowerCase().includes(q));
  list.innerHTML = matches.map((c, i) =>
    `<div class="pal-item${i === palFocus ? ' focused' : ''}" data-idx="${i}">
      <span>${c.label}</span>
      <span class="pal-key">${c.key}</span>
    </div>`
  ).join('');
  list.querySelectorAll('.pal-item').forEach((el, i) => {
    el.addEventListener('click', () => { closePalette(); matches[i].run(); });
  });
}

document.getElementById('palette-input').addEventListener('input', e => {
  palFocus = 0;
  renderPalette(e.target.value);
});

document.getElementById('palette-input').addEventListener('keydown', e => {
  const items = document.querySelectorAll('.pal-item');
  if (e.key === 'ArrowDown') { palFocus = Math.min(palFocus + 1, items.length - 1); }
  else if (e.key === 'ArrowUp') { palFocus = Math.max(palFocus - 1, 0); }
  else if (e.key === 'Enter') {
    const q = document.getElementById('palette-input').value.toLowerCase();
    const matches = COMMANDS.filter(c => c.label.toLowerCase().includes(q));
    if (matches[palFocus]) { closePalette(); matches[palFocus].run(); }
    return;
  } else if (e.key === 'Escape') { closePalette(); return; }
  renderPalette(document.getElementById('palette-input').value);
  e.preventDefault();
});

// â”€â”€â”€ Global Keyboard Shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e => {
  const mod = e.ctrlKey || e.metaKey;
  if (mod && e.key === 'n')            { e.preventDefault(); openModal('new-modal'); }
  if (mod && e.key === 's' && !e.shiftKey) { e.preventDefault(); saveFile(); }
  if (mod && e.shiftKey && e.key === 'S')  { e.preventDefault(); saveAllFiles(); }
  if (mod && e.key === 'b')            { e.preventDefault(); toggleSidebar(); }
  if (mod && e.shiftKey && e.key === 'P')  { e.preventDefault(); openPalette(); }
  if (mod && e.key === '=')            { e.preventDefault(); zoomIn(); }
  if (mod && e.key === '-')            { e.preventDefault(); zoomOut(); }
  if (e.key === 'Escape')              { closePalette(); closeAllMenus(); }

  // modal enters
  if (e.key === 'Enter') {
    if (!document.getElementById('new-modal').classList.contains('hidden'))    confirmNew();
    if (!document.getElementById('rename-modal').classList.contains('hidden')) confirmRename();
    if (!document.getElementById('lang-modal').classList.contains('hidden'))   confirmLang();
  }
  if (e.key === 'Escape') {
    ['new-modal','rename-modal','lang-modal'].forEach(closeModal);
  }
});

// â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
require.config({ paths: { vs: VS_PATH } });

require(['vs/editor/editor.main'], () => {
  editor = monaco.editor.create(document.getElementById('editor'), {
    theme: 'vs-dark',
    fontSize: 14,
    fontFamily: "'Cascadia Code', 'JetBrains Mono', 'Fira Code', 'Consolas', monospace",
    fontLigatures: true,
    lineNumbers: 'on',
    minimap: { enabled: true },
    scrollBeyondLastLine: false,
    automaticLayout: true,
    tabSize: 2,
    wordWrap: 'off',
    padding: { top: 10 },
    bracketPairColorization: { enabled: true },
    guides: { bracketPairs: true },
    smoothScrolling: true,
    cursorBlinking: 'smooth',
    cursorSmoothCaretAnimation: 'on',
    renderWhitespace: 'selection',
    suggest: { showIcons: true },
  });

  // Status bar: cursor position
  editor.onDidChangeCursorPosition(e => {
    document.getElementById('sb-cursor').textContent =
      `Ln ${e.position.lineNumber}, Col ${e.position.column}`;
  });

  // Status bar: errors
  editor.onDidChangeModelContent(() => {
    const model = editor.getModel();
    if (!model) return;
    const markers = monaco.editor.getModelMarkers({ resource: model.uri });
    const errs  = markers.filter(m => m.severity === monaco.MarkerSeverity.Error).length;
    const warns = markers.filter(m => m.severity === monaco.MarkerSeverity.Warning).length;
    document.getElementById('sb-errors').textContent =
      errs  ? `âœ— ${errs} error${errs > 1 ? 's' : ''}` :
      warns ? `âš  ${warns} warning${warns > 1 ? 's' : ''}` :
      'âœ“ No problems';
  });

  // Load files
  const stored = loadStored();
  const seed   = stored && Object.keys(stored).length ? stored : DEFAULT_FILES;
  for (const [name, content] of Object.entries(seed)) addFile(name, content, false);

  // Open first
  switchTo(Object.keys(files)[0]);
});
</script>
</body>
</html>
